@model SalesFiguresAPI.Models.HomePageViewModel
@{ 
    string test = string.Empty;
}
<div class="jumbotron">
    <h1>Sales Dashboard</h1>
    @*@Html.EnumDropDownListFor(m => m.SelectedStore, new { @class = "form-control" })*@
</div>
<div class="row">
    @foreach (var storeData in Model.TodayCumulativeFigures) {

        <h3>@storeData.StoreId</h3>
        <p>@storeData.StoreName</p>
        <canvas id="@(storeData.StoreId + "canvas")" width="800" height="400"></canvas>
    }
</div>
@section Scripts{
    <script>
        var results = @Html.Raw(Json.Encode(Model.TodayCumulativeFigures));
        console.log(results);
        console.log(results.length);
        for(var i = 0; i< results.length; i++){
            console.log('What happen');
            var nameOfCanvas = results[i].StoreId + 'canvas';
            var context = $("#"+nameOfCanvas).get(0).getContext("2d");

            console.log(context);

            var storeData = results[i].Data;

            var todaysValues = storeData.map(function(a) { if (a.TodaysValue != 0 ) return a.TodaysValue; else return undefined; });
            var lastYearsValues = storeData.map(function(a) {return a.LastYearsValue;});

            console.log(todaysValues);

            var data = {
                labels: [9,10,11,12,13,14,15,16,17,18,19,20,21],
                datasets: [
                    {
                        label: 'Todays Values',
                        fill: false,
                        spanGaps: false,
                        lineTension: 0.1,
                        backgroundColor: "rgba(75,192,192,0.4)",
                        borderColor: "rgba(75,192,192,1)",
                        borderCapStyle: 'butt',
                        borderDash: [],
                        borderDashOffset: 0.0,
                        borderJoinStyle: 'miter',
                        pointBorderColor: "rgba(75,192,192,1)",
                        pointBackgroundColor: "#fff",
                        pointBorderWidth: 1,
                        pointHoverRadius: 5,
                        pointHoverBackgroundColor: "rgba(75,192,192,1)",
                        pointHoverBorderColor: "rgba(220,220,220,1)",
                        pointHoverBorderWidth: 2,
                        pointRadius: 1,
                        pointHitRadius: 10,
                        data: todaysValues
                    },
                    {
                        label: 'Last Years Values',
                        fill: false,
                        spanGaps: false,
                        lineTension: 0.1,
                        backgroundColor: "rgba(57,125,2,0.4)",
                        borderColor: "#397D02",
                        borderCapStyle: 'butt',
                        borderDash: [],
                        borderDashOffset: 0.0,
                        borderJoinStyle: 'miter',
                        pointBorderColor: "#397D02",
                        pointBackgroundColor: "#fff",
                        pointBorderWidth: 1,
                        pointHoverRadius: 5,
                        pointHoverBackgroundColor: "#397D02",
                        pointHoverBorderColor: "rgba(220,220,220,1)",
                        pointHoverBorderWidth: 2,
                        pointRadius: 1,
                        pointHitRadius: 10,
                        data: lastYearsValues
                    }]
            }
            var myNewChart = new Chart(context, {
                type: "line",
                data: data
            });
        }

    </script>
}